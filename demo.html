<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>TP SOC — Demo Services Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        :root {
            --rest: #2563eb;
            --soap: #7c3aed;
            --graphql: #e11d48;
            --grpc: #0891b2;
            --bg: #0f172a;
            --surface: #1e293b;
            --card: #263348;
            --border: #334155;
            --text: #e2e8f0;
            --muted: #94a3b8;
            --success: #22c55e;
            --error: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
        }

        /* ── HEADER ── */
        header {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        header h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        header span {
            font-size: 0.85rem;
            color: var(--muted);
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }

        /* ── TABS ── */
        nav {
            display: flex;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
        }

        .tab-btn {
            padding: 1rem 1.6rem;
            border: none;
            background: transparent;
            color: var(--muted);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all .2s;
            display: flex;
            align-items: center;
            gap: .5rem;
        }

        .tab-btn:hover {
            color: var(--text);
        }

        .tab-btn.active {
            color: var(--text);
        }

        #tab-rest.active {
            border-color: var(--rest);
            color: #60a5fa;
        }

        #tab-soap.active {
            border-color: var(--soap);
            color: #a78bfa;
        }

        #tab-gql.active {
            border-color: var(--graphql);
            color: #fb7185;
        }

        #tab-grpc.active {
            border-color: var(--grpc);
            color: #38bdf8;
        }

        /* ── CONTENT ── */
        .tab-content {
            display: none;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content.active {
            display: block;
        }

        /* ── CARDS / PANELS ── */
        .panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .panel h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: .5rem;
        }

        .badge {
            display: inline-block;
            padding: .15rem .55rem;
            border-radius: 6px;
            font-size: .7rem;
            font-weight: 700;
            letter-spacing: .04em;
        }

        .badge-get {
            background: #1d4ed8;
            color: #bfdbfe;
        }

        .badge-post {
            background: #166534;
            color: #bbf7d0;
        }

        .badge-put {
            background: #92400e;
            color: #fde68a;
        }

        .badge-patch {
            background: #7c2d12;
            color: #fed7aa;
        }

        .badge-delete {
            background: #7f1d1d;
            color: #fecaca;
        }

        .badge-soap {
            background: #4c1d95;
            color: #ddd6fe;
        }

        .badge-gql {
            background: #881337;
            color: #fecdd3;
        }

        .badge-grpc {
            background: #164e63;
            color: #bae6fd;
        }

        /* ── BUTTONS ── */
        .btn {
            border: none;
            border-radius: 8px;
            padding: .6rem 1.2rem;
            cursor: pointer;
            font-size: .85rem;
            font-weight: 600;
            transition: opacity .15s, transform .1s;
            display: inline-flex;
            align-items: center;
            gap: .4rem;
        }

        .btn:hover {
            opacity: .85;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-rest {
            background: var(--rest);
            color: #fff;
        }

        .btn-soap {
            background: var(--soap);
            color: #fff;
        }

        .btn-gql {
            background: var(--graphql);
            color: #fff;
        }

        .btn-grpc {
            background: var(--grpc);
            color: #fff;
        }

        .btn-sm {
            padding: .35rem .8rem;
            font-size: .78rem;
        }

        /* ── GRID ── */
        .grid2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media(max-width:768px) {
            .grid2 {
                grid-template-columns: 1fr;
            }
        }

        /* ── RESPONSE BOX ── */
        .response-box {
            background: #0d1117;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Cascadia Code', 'Fira Code', monospace;
            font-size: .78rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 380px;
            overflow-y: auto;
            color: #c9d1d9;
            min-height: 60px;
        }

        .response-box .ok {
            color: var(--success);
        }

        .response-box .err {
            color: var(--error);
        }

        /* ── STATUS BAR ── */
        .status-bar {
            display: flex;
            align-items: center;
            gap: .5rem;
            margin-bottom: .5rem;
            font-size: .78rem;
            font-weight: 600;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.ok {
            background: var(--success);
        }

        .status-dot.err {
            background: var(--error);
        }

        .status-dot.idle {
            background: var(--muted);
        }

        /* ── INPUT ROW ── */
        .input-row {
            display: flex;
            gap: .5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        input[type=text],
        input[type=number],
        textarea,
        select {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 8px;
            padding: .55rem .8rem;
            font-size: .85rem;
            font-family: inherit;
            outline: none;
            transition: border-color .2s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: #60a5fa;
        }

        textarea {
            resize: vertical;
            font-family: 'Cascadia Code', monospace;
            font-size: .8rem;
            color: #e2e8f0 !important;
        }

        label {
            font-size: .82rem;
            color: var(--muted);
            font-weight: 600;
        }

        /* ── SECTION TITLE ── */
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: .6rem;
        }

        /* ── INFO BOX ── */
        .info-box {
            background: var(--card);
            border-left: 3px solid;
            border-radius: 0 8px 8px 0;
            padding: .8rem 1rem;
            margin-bottom: 1rem;
            font-size: .85rem;
            line-height: 1.6;
        }

        .info-box.rest {
            border-color: var(--rest);
        }

        .info-box.soap {
            border-color: var(--soap);
        }

        .info-box.gql {
            border-color: var(--graphql);
        }

        .info-box.grpc {
            border-color: var(--grpc);
        }

        /* ── XML / CODE ── */
        .code-block {
            background: #0d1117;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Cascadia Code', 'Fira Code', monospace;
            font-size: .77rem;
            line-height: 1.7;
            overflow-x: auto;
            color: #c9d1d9;
            white-space: pre;
        }

        .hl-tag {
            color: #7ee787;
        }

        .hl-attr {
            color: #79c0ff;
        }

        .hl-val {
            color: #ffab70;
        }

        .hl-str {
            color: #a5d6ff;
        }

        .hl-kw {
            color: #f97583;
        }

        .hl-cmt {
            color: #8b949e;
            font-style: italic;
        }

        .hl-type {
            color: #d2a8ff;
        }

        /* ── FLOW DIAGRAM ── */
        .flow {
            display: flex;
            align-items: center;
            gap: .5rem;
            flex-wrap: wrap;
            margin: 1rem 0;
            font-size: .82rem;
        }

        .flow-box {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: .4rem .8rem;
        }

        .flow-arrow {
            color: var(--muted);
            font-size: 1.1rem;
        }

        /* ── SPINNER ── */
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #ffffff44;
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin .6s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ── SCROLLBAR ── */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }
    </style>
</head>

<body>

    <header>
        <div>
            <h1>TP — Architectures orientées services</h1>
            <span>REST · SOAP/WSDL · GraphQL · gRPC</span>
        </div>
    </header>

    <nav>
        <button class="tab-btn active" id="tab-rest" onclick="switchTab('rest')">
            <span class="dot" style="background:#2563eb"></span> REST API
        </button>
        <button class="tab-btn" id="tab-soap" onclick="switchTab('soap')">
            <span class="dot" style="background:#7c3aed"></span> SOAP / WSDL
        </button>
        <button class="tab-btn" id="tab-gql" onclick="switchTab('gql')">
            <span class="dot" style="background:#e11d48"></span> GraphQL
        </button>
        <button class="tab-btn" id="tab-grpc" onclick="switchTab('grpc')">
            <span class="dot" style="background:#0891b2"></span> gRPC
        </button>
    </nav>

    <!-- ═══════════════════════════════════════════════════════ REST ═══ -->
    <div class="tab-content active" id="content-rest">
        <div class="section-title">
            <span class="dot" style="background:var(--rest);width:14px;height:14px"></span>
            REST API — Travel Planner
            <span style="font-size:.8rem;color:var(--muted);font-weight:400">Flask · localhost:5000</span>
        </div>

        <div class="grid2">
            <!-- GET ALL -->
            <div class="panel">
                <h3><span class="badge badge-get">GET</span> /destinations</h3>
                <div class="input-row">
                    <label>Pays :</label><input type="text" id="rest-country" placeholder="France" style="width:100px">
                    <label>Prix max :</label><input type="number" id="rest-maxprice" placeholder="200"
                        style="width:80px">
                    <button class="btn btn-rest" onclick="restGetAll()">GET</button>
                </div>
                <div class="status-bar"><span class="status-dot idle" id="s-getall"></span><span
                        id="st-getall">Inactif</span></div>
                <div class="response-box" id="r-getall">En attente…</div>
            </div>

            <!-- GET ONE -->
            <div class="panel">
                <h3><span class="badge badge-get">GET</span> /destinations/:id</h3>
                <div class="input-row">
                    <label>ID :</label>
                    <select id="rest-getid" style="width:80px">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                    </select>
                    <button class="btn btn-rest" onclick="restGetOne()">GET</button>
                </div>
                <div class="status-bar"><span class="status-dot idle" id="s-getone"></span><span
                        id="st-getone">Inactif</span></div>
                <div class="response-box" id="r-getone">En attente…</div>
            </div>

            <!-- POST -->
            <div class="panel">
                <h3><span class="badge badge-post">POST</span> /destinations — Créer</h3>
                <div class="input-row">
                    <label>Nom :</label><input type="text" id="rest-pname" value="Dubai" style="width:110px">
                    <label>Pays :</label><input type="text" id="rest-pct" value="UAE" style="width:80px">
                    <label>Prix/j :</label><input type="number" id="rest-pprice" value="250" style="width:70px">
                </div>
                <div class="input-row">
                    <label>Activités :</label><input type="text" id="rest-pact" value="Burj Khalifa, Desert Safari"
                        style="width:240px">
                    <button class="btn btn-rest" onclick="restPost()">POST</button>
                </div>
                <div class="status-bar"><span class="status-dot idle" id="s-post"></span><span
                        id="st-post">Inactif</span></div>
                <div class="response-box" id="r-post">En attente…</div>
            </div>

            <!-- PUT -->
            <div class="panel">
                <h3><span class="badge badge-put">PUT</span> /destinations/:id — Mise à jour complète</h3>
                <div class="input-row">
                    <label>ID :</label>
                    <select id="rest-putid" style="width:70px">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                    </select>
                    <label>Nom :</label><input type="text" id="rest-putname" value="Paris Updated" style="width:130px">
                    <label>Pays :</label><input type="text" id="rest-putcountry" value="France" style="width:90px">
                </div>
                <div class="input-row">
                    <label>Prix/j :</label><input type="number" id="rest-putprice" value="999" style="width:80px">
                    <label>Activités :</label><input type="text" id="rest-putactivities" value="Tour Eiffel, Versailles"
                        style="width:200px">
                    <button class="btn btn-rest" onclick="restPut()">PUT</button>
                </div>
                <div class="status-bar"><span class="status-dot idle" id="s-put"></span><span id="st-put">Inactif</span>
                </div>
                <div class="response-box" id="r-put">En attente…</div>
            </div>

            <!-- PATCH -->
            <div class="panel">
                <h3><span class="badge badge-patch">PATCH</span> /destinations/:id — Partiel</h3>
                <div class="input-row">
                    <label>ID :</label>
                    <select id="rest-patchid" style="width:70px">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                    </select>
                    <label>Nouveau prix :</label><input type="number" id="rest-patchprice" value="120"
                        style="width:80px">
                    <button class="btn btn-rest" onclick="restPatch()">PATCH</button>
                </div>
                <div class="status-bar"><span class="status-dot idle" id="s-patch"></span><span
                        id="st-patch">Inactif</span></div>
                <div class="response-box" id="r-patch">En attente…</div>
            </div>

            <!-- DELETE -->
            <div class="panel">
                <h3><span class="badge badge-delete">DELETE</span> /destinations/:id</h3>
                <div class="input-row">
                    <label>ID :</label>
                    <select id="rest-delid" style="width:70px">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                    </select>
                    <button class="btn btn-rest" onclick="restDelete()">Supprimer</button>
                </div>
                <div class="status-bar"><span class="status-dot idle" id="s-del"></span><span id="st-del">Inactif</span>
                </div>
                <div class="response-box" id="r-del">En attente…</div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════ SOAP ═══ -->
    <div class="tab-content" id="content-soap">
        <div class="section-title">
            <span class="dot" style="background:var(--soap);width:14px;height:14px"></span>
            SOAP / WSDL — Banking Service
            <span style="font-size:.8rem;color:var(--muted);font-weight:400">Spyne · localhost:8000</span>
        </div>

        <div class="info-box soap">
            Service bancaire exposé via <strong>SOAP 1.1</strong> avec un contrat <strong>WSDL auto-généré</strong>.
            Les types de données sont définis comme des <strong>schémas XSD</strong> (Customer, Account, Transaction).
            Côté client, la bibliothèque <code>zeep</code> parse le WSDL et sérialise les enveloppes XML
            automatiquement.
        </div>

        <!-- Comment SPYNE génère le WSDL -->
        <div style="margin-top: 1.5rem;">
            <h3 style="margin-bottom: 1rem; color: #a8dadc; font-size: 1rem;">Comment fonctionne la génération WSDL ?</h3>
            
            <div class="grid2" style="margin-bottom: 1rem;">
                <div class="panel" style="padding: 1rem; border-left: 3px solid #7c3aed;">
                    <h4 style="font-size: 0.95rem; margin-bottom: 0.5rem; color: #e2e8f0;">
                        Modèles de Données (ComplexModel)
                    </h4>
                    <p style="font-size: 0.85rem; color: var(--muted); margin: 0;">
                        Les classes <code>Customer</code>, <code>Account</code>, et <code>Transaction</code> 
                        héritent de <strong>ComplexModel</strong> de Spyne. Chaque propriété de classe devient 
                        un type XSD dans le WSDL généré.
                    </p>
                    <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(124, 58, 237, 0.1); border-radius: 4px; font-size: 0.75rem; color: #cbd5e1; font-family: monospace;">
                        class Customer(ComplexModel):<br>
                        &nbsp;&nbsp;customer_id = Unicode<br>
                        &nbsp;&nbsp;first_name = Unicode<br>
                        &nbsp;&nbsp;registration_date = DateTime
                    </div>
                </div>

                <div class="panel" style="padding: 1rem; border-left: 3px solid #7c3aed;">
                    <h4 style="font-size: 0.95rem; margin-bottom: 0.5rem; color: #e2e8f0;">
                        Opérations SOAP (@rpc)
                    </h4>
                    <p style="font-size: 0.85rem; color: var(--muted); margin: 0;">
                        Le décorateur <strong>@rpc</strong> expose les méthodes comme opérations SOAP dans le WSDL. 
                        Les paramètres et le type de retour (<code>_returns</code>) définissent automatiquement 
                        la signature WSDL.
                    </p>
                    <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(124, 58, 237, 0.1); border-radius: 4px; font-size: 0.75rem; color: #cbd5e1; font-family: monospace;">
                        @rpc(Unicode, Float, _returns=Boolean)<br>
                        def transfer_money(ctx, account, amount):<br>
                        &nbsp;&nbsp;# Implémentation
                    </div>
                </div>

                <div class="panel" style="padding: 1rem; border-left: 3px solid #7c3aed;">
                    <h4 style="font-size: 0.95rem; margin-bottom: 0.5rem; color: #e2e8f0;">
                        Configuration Application
                    </h4>
                    <p style="font-size: 0.85rem; color: var(--muted); margin: 0;">
                        <strong>Spyne</strong> crée automatiquement l'application SOAP avec le protocole SOAP 1.1, 
                        le namespace cible, et génère le WSDL en fonction de tous les modèles et @rpc déclarés.
                    </p>
                    <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(124, 58, 237, 0.1); border-radius: 4px; font-size: 0.75rem; color: #cbd5e1; font-family: monospace;">
                        app = Application([BankingService],<br>
                        &nbsp;&nbsp;tns='http://banking.soap.example.com')<br>
                        # WSDL généré automatiquement!
                    </div>
                </div>

                <div class="panel" style="padding: 1rem; border-left: 3px solid #7c3aed;">
                    <h4 style="font-size: 0.95rem; margin-bottom: 0.5rem; color: #e2e8f0;">
                        Accès au WSDL
                    </h4>
                    <p style="font-size: 0.85rem; color: var(--muted); margin: 0;">
                        Le WSDL généré peut être consulté à l'adresse :
                    </p>
                    <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(124, 58, 237, 0.1); border-radius: 4px; font-size: 0.75rem; color: #22c55e; font-family: monospace;">
                        <strong>http://localhost:8000/?wsdl</strong>
                    </div>
                    <p style="font-size: 0.8rem; color: var(--muted); margin-top: 0.5rem; margin-bottom: 0;">
                        Les clients SOAP (comme <code>zeep</code>) accèdent à ce WSDL pour connaître les 
                        opérations et structures de données disponibles.
                    </p>
                </div>
            </div>
        </div>

        <div class="flow">
            <div class="flow-box">Client Python (zeep)</div>
            <span class="flow-arrow">→</span>
            <div class="flow-box">Enveloppe SOAP / XML</div>
            <span class="flow-arrow">→</span>
            <div class="flow-box">HTTP POST :8000</div>
            <span class="flow-arrow">→</span>
            <div class="flow-box">Spyne (parse WSDL)</div>
            <span class="flow-arrow">→</span>
            <div class="flow-box">Réponse SOAP / XML</div>
        </div>

        <div class="grid2">
            <div class="panel">
                <h3><span class="badge badge-soap">SOAP</span> Requête : get_customer_info</h3>
                <p style="font-size:.75rem;color:var(--muted);margin-bottom:.6rem">
                    <strong>HTTP POST</strong> <code>http://localhost:8000/</code>
                </p>
                <div class="code-block">&lt;?xml version='1.0' encoding='utf-8'?&gt;
                    <span class="hl-tag">&lt;soap-env:Envelope</span>
                    <span class="hl-attr">xmlns:soap-env</span>=<span
                        class="hl-val">"http://schemas.xmlsoap.org/soap/envelope/"</span><span
                        class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;soap-env:Body&gt;</span>
                    <span class="hl-tag">&lt;ns0:get_customer_info</span>
                    <span class="hl-attr">xmlns:ns0</span>=<span
                        class="hl-val">"http://banking.soap.example.com"</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;ns0:customer_id&gt;</span><span class="hl-str">CUST001</span><span
                        class="hl-tag">&lt;/ns0:customer_id&gt;</span>
                    <span class="hl-tag">&lt;/ns0:get_customer_info&gt;</span>
                    <span class="hl-tag">&lt;/soap-env:Body&gt;</span>
                    <span class="hl-tag">&lt;/soap-env:Envelope&gt;</span>
                </div>
            </div>

            <div class="panel">
                <h3><span class="badge badge-soap">SOAP</span> Réponse : get_customer_infoResponse</h3>
                <p style="font-size:.75rem;color:var(--muted);margin-bottom:.6rem">
                    <strong>HTTP Response</strong> <code>http://localhost:8000/</code> <span style="color:#22c55e;font-weight:600">(status: 200)</span>
                </p>
                
                <div class="code-block">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
                    <span class="hl-tag">&lt;soap11env:Envelope</span>
                    <span class="hl-attr">xmlns:soap11env</span>=<span
                        class="hl-val">"http://schemas.xmlsoap.org/soap/envelope/"</span>
                    <span class="hl-attr">xmlns:tns</span>=<span
                        class="hl-val">"http://banking.soap.example.com"</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;soap11env:Body&gt;</span>
                    <span class="hl-tag">&lt;tns:get_customer_infoResponse&gt;</span>
                    <span class="hl-tag">&lt;tns:get_customer_infoResult&gt;</span>
                    <span class="hl-tag">&lt;tns:customer_id&gt;</span><span class="hl-str">CUST001</span><span
                        class="hl-tag">&lt;/tns:customer_id&gt;</span>
                    <span class="hl-tag">&lt;tns:first_name&gt;</span><span class="hl-str">Cyrine</span><span
                        class="hl-tag">&lt;/tns:first_name&gt;</span>
                    <span class="hl-tag">&lt;tns:last_name&gt;</span><span class="hl-str">Zribi</span><span
                        class="hl-tag">&lt;/tns:last_name&gt;</span>
                    <span class="hl-tag">&lt;tns:email&gt;</span><span
                        class="hl-str">cyrine.zribi@telecom-sudparis.eu</span><span
                        class="hl-tag">&lt;/tns:email&gt;</span>
                    <span class="hl-tag">&lt;tns:phone&gt;</span><span class="hl-str">+33 6 12 34 56 78</span><span
                        class="hl-tag">&lt;/tns:phone&gt;</span>
                    <span class="hl-tag">&lt;tns:registration_date&gt;</span><span
                        class="hl-str">2024-01-15T00:00:00</span><span
                        class="hl-tag">&lt;/tns:registration_date&gt;</span>
                    <span class="hl-tag">&lt;/tns:get_customer_infoResult&gt;</span>
                    <span class="hl-tag">&lt;/tns:get_customer_infoResponse&gt;</span>
                    <span class="hl-tag">&lt;/soap11env:Body&gt;</span>
                    <span class="hl-tag">&lt;/soap11env:Envelope&gt;</span>
                </div>
            </div>


            <div class="panel" style="grid-column: 1 / -1">
                <h3><span class="badge badge-soap">WSDL</span> Structure du WSDL auto-généré — <code style="font-size:.8rem;color:var(--muted)">GET http://localhost:8000/?wsdl</code></h3>
                <p style="font-size:.8rem;color:var(--muted);margin-bottom:1rem">Le WSDL est divisé en 5 sections. Voici un exemple de chacune :</p>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">

                    <div>
                        <p style="font-size:.78rem;font-weight:700;color:#a78bfa;margin-bottom:.4rem">① &lt;wsdl:types&gt; — Schémas XSD des données</p>
                        <div class="code-block" style="font-size:.72rem"><span class="hl-tag">&lt;xs:complexType</span> <span class="hl-attr">name</span>=<span class="hl-val">"Customer"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;xs:sequence&gt;</span>
    <span class="hl-tag">&lt;xs:element</span> <span class="hl-attr">name</span>=<span class="hl-val">"customer_id"</span>  <span class="hl-attr">type</span>=<span class="hl-val">"xs:string"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;xs:element</span> <span class="hl-attr">name</span>=<span class="hl-val">"first_name"</span>   <span class="hl-attr">type</span>=<span class="hl-val">"xs:string"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;xs:element</span> <span class="hl-attr">name</span>=<span class="hl-val">"last_name"</span>    <span class="hl-attr">type</span>=<span class="hl-val">"xs:string"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;xs:element</span> <span class="hl-attr">name</span>=<span class="hl-val">"email"</span>        <span class="hl-attr">type</span>=<span class="hl-val">"xs:string"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;xs:element</span> <span class="hl-attr">name</span>=<span class="hl-val">"phone"</span>        <span class="hl-attr">type</span>=<span class="hl-val">"xs:string"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;xs:element</span> <span class="hl-attr">name</span>=<span class="hl-val">"registration_date"</span> <span class="hl-attr">type</span>=<span class="hl-val">"xs:dateTime"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/xs:sequence&gt;</span>
<span class="hl-tag">&lt;/xs:complexType&gt;</span></div>
                    </div>

                    <div>
                        <p style="font-size:.78rem;font-weight:700;color:#a78bfa;margin-bottom:.4rem">② &lt;wsdl:message&gt; — Enveloppes d'entrée/sortie</p>
                        <div class="code-block" style="font-size:.72rem"><span class="hl-tag">&lt;wsdl:message</span> <span class="hl-attr">name</span>=<span class="hl-val">"get_customer_info"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;wsdl:part</span> <span class="hl-attr">name</span>=<span class="hl-val">"get_customer_info"</span>
    <span class="hl-attr">element</span>=<span class="hl-val">"tns:get_customer_info"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/wsdl:message&gt;</span>

<span class="hl-tag">&lt;wsdl:message</span> <span class="hl-attr">name</span>=<span class="hl-val">"get_customer_infoResponse"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;wsdl:part</span> <span class="hl-attr">name</span>=<span class="hl-val">"get_customer_infoResponse"</span>
    <span class="hl-attr">element</span>=<span class="hl-val">"tns:get_customer_infoResponse"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/wsdl:message&gt;</span>
</div>
                    </div>

                    <div>
                        <p style="font-size:.78rem;font-weight:700;color:#a78bfa;margin-bottom:.4rem">③ &lt;wsdl:portType&gt; — Interface abstraite (opérations)</p>
                        <div class="code-block" style="font-size:.72rem"><span class="hl-tag">&lt;wsdl:portType</span> <span class="hl-attr">name</span>=<span class="hl-val">"Application"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;wsdl:operation</span> <span class="hl-attr">name</span>=<span class="hl-val">"get_customer_info"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;wsdl:input</span>  <span class="hl-attr">message</span>=<span class="hl-val">"tns:get_customer_info"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;wsdl:output</span> <span class="hl-attr">message</span>=<span class="hl-val">"tns:get_customer_infoResponse"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/wsdl:operation&gt;</span>
<span class="hl-tag">&lt;/wsdl:portType&gt;</span></div>
                    </div>

                    <div>
                        <p style="font-size:.78rem;font-weight:700;color:#a78bfa;margin-bottom:.4rem">④ &lt;wsdl:binding&gt; — Liaison concrète SOAP 1.1</p>
                        <div class="code-block" style="font-size:.72rem"><span class="hl-tag">&lt;wsdl:binding</span> <span class="hl-attr">name</span>=<span class="hl-val">"Application"</span> <span class="hl-attr">type</span>=<span class="hl-val">"tns:Application"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;wsdlsoap11:binding</span> <span class="hl-attr">style</span>=<span class="hl-val">"document"</span>
    <span class="hl-attr">transport</span>=<span class="hl-val">"http://schemas.xmlsoap.org/soap/http"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;wsdl:operation</span> <span class="hl-attr">name</span>=<span class="hl-val">"get_customer_info"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;wsdlsoap11:operation</span> <span class="hl-attr">soapAction</span>=<span class="hl-val">"get_customer_info"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;wsdl:input</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;wsdlsoap11:body</span> <span class="hl-attr">use</span>=<span class="hl-val">"literal"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/wsdl:input&gt;</span>
    <span class="hl-tag">&lt;wsdl:output</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;wsdlsoap11:body</span> <span class="hl-attr">use</span>=<span class="hl-val">"literal"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/wsdl:output&gt;</span>
  <span class="hl-tag">&lt;/wsdl:operation&gt;</span>
<span class="hl-tag">&lt;/wsdl:binding&gt;</span></div>
                    </div>

                </div>

                <div style="margin-top:1rem">
                    <p style="font-size:.78rem;font-weight:700;color:#a78bfa;margin-bottom:.4rem">⑤ &lt;wsdl:service&gt; — Point d'accès réseau</p>
                    <div class="code-block" style="font-size:.72rem"><span class="hl-tag">&lt;wsdl:service</span> <span class="hl-attr">name</span>=<span class="hl-val">"BankingService"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;wsdl:port</span> <span class="hl-attr">name</span>=<span class="hl-val">"Application"</span> <span class="hl-attr">binding</span>=<span class="hl-val">"tns:Application"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;wsdlsoap11:address</span> <span class="hl-attr">location</span>=<span class="hl-val">"http://localhost:8000/"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/wsdl:port&gt;</span>
<span class="hl-tag">&lt;/wsdl:service&gt;</span></div>
                </div>
            </div>
        </div>

    </div>

    <!-- ═══════════════════════════════════════════════════════ GRAPHQL ═══ -->
    <div class="tab-content" id="content-gql">
        <div class="section-title">
            <span class="dot" style="background:var(--graphql);width:14px;height:14px"></span>
            GraphQL — Travel Planner
            <span style="font-size:.8rem;color:var(--muted);font-weight:400">Graphene · localhost:5001</span>
        </div>

        <div class="grid2">
            <div class="panel">
                <h3><span class="badge badge-gql">QUERY</span> Scénarios du client.py (7 exemples)</h3>
                <div class="input-row" style="flex-wrap:wrap;gap:.5rem;margin-bottom:1rem">

                    <button class="btn btn-gql btn-sm"
                        onclick="gqlPreset(`query {\n  destinations {\n    id\n    name\n    country\n    pricePerDay\n    activities\n  }\n}`)">
                        1 · Toutes les destinations
                    </button>

                    <button class="btn btn-gql btn-sm"
                        onclick="gqlPreset(`query {\n  destinations(country: &quot;France&quot;) {\n    id\n    name\n    country\n    pricePerDay\n  }\n}`)">
                        2 · Filtrer par pays (France)
                    </button>

                    <button class="btn btn-gql btn-sm"
                        onclick="gqlPreset(`query {\n  destination(id: 1) {\n    name\n    activities\n  }\n}`)">
                        3 · Champs minimaux (ID=1)
                    </button>

                    <button class="btn btn-gql btn-sm"
                        onclick="gqlPreset(`query {\n  destinations(maxPrice: 150) {\n    name\n    pricePerDay\n  }\n}`)">
                        4 · Budget ≤ 150 €/jour
                    </button>

                    <button class="btn btn-gql btn-sm"
                        onclick="gqlPreset(`mutation {\n  createDestination(input: {\n    name: &quot;Rome&quot;\n    country: &quot;Italy&quot;\n    pricePerDay: 140\n    activities: [&quot;Colosseum&quot;, &quot;Vatican&quot;, &quot;Trevi Fountain&quot;]\n  }) {\n    success\n    message\n    destination {\n      id\n      name\n      country\n    }\n  }\n}`)">
                        5 · Mutation : créer Rome
                    </button>

                    <button class="btn btn-gql btn-sm"
                        onclick="gqlPreset(`mutation {\n  updateDestination(id: 1, pricePerDay: 165) {\n    success\n    message\n    destination {\n      name\n      pricePerDay\n    }\n  }\n}`)">
                        6 · Mutation : màj prix ID=1
                    </button>

                    <button class="btn btn-gql btn-sm"
                        onclick="gqlPreset(`mutation {\n  deleteDestination(id: 4) {\n    success\n    message\n  }\n}`)">
                        7 · Mutation : supprimer ID=4
                    </button>

                </div>

                <label style="display:block;margin-bottom:.4rem">Requête GraphQL :</label>
                <textarea id="gql-query" rows="10" style="width:100%;margin-bottom:.8rem">query {
  destinations {
    id
    name
    country
    pricePerDay
    activities
  }
}</textarea>
                <button class="btn btn-gql" onclick="gqlSend()">Exécuter</button>
                <div class="status-bar" style="margin-top:.8rem">
                    <span class="status-dot idle" id="s-gql"></span><span id="st-gql">Inactif</span>
                </div>
            </div>

            <div class="panel">
                <h3>Réponse GraphQL</h3>
                <div class="response-box" style="max-height:420px" id="r-gql">En attente d'une requête…</div>
            </div>
        </div>

        <!-- panneau subscription -->
        <div class="panel" style="border-color:#e11d48">
            <h3>
                <span class="badge badge-gql">SUBSCRIPTION</span>
                Simulation temps réel
            </h3>

            <!-- schéma conceptuel -->
            <div style="background:#0d1117;border:1px solid var(--border);border-radius:8px;padding:1rem;margin-bottom:1rem;font-family:'Cascadia Code',monospace;font-size:.78rem;color:#c9d1d9;line-height:1.8">
                <!-- <span style="color:#8b949e"># Schéma conceptuel de la subscription</span><br> -->
                <span style="color:#f97583">subscription</span> {<br>
                &nbsp;&nbsp;<span style="color:#79c0ff">destinationAdded</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;id &nbsp;name &nbsp;country &nbsp;pricePerDay<br>
                &nbsp;&nbsp;}<br>
                &nbsp;&nbsp;<span style="color:#79c0ff">destinationUpdated</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;id &nbsp;name &nbsp;pricePerDay<br>
                &nbsp;&nbsp;}<br>
                &nbsp;&nbsp;<span style="color:#79c0ff">destinationDeleted</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;id &nbsp;name<br>
                &nbsp;&nbsp;}<br>
                }
            </div>

            <div class="input-row">
                <button class="btn btn-gql" id="btn-sub" onclick="gqlSubscribe()">S'abonner</button>
                <button class="btn" style="background:#334155;color:#e2e8f0" onclick="gqlUnsubscribe()">Se désabonner</button>
                <span style="font-size:.8rem;color:var(--muted)" id="sub-counter"></span>
            </div>

            <div class="status-bar">
                <span class="status-dot idle" id="s-sub"></span>
                <span id="st-sub">Non connecté</span>
            </div>

            <label style="display:block;margin-top:.8rem;margin-bottom:.4rem">Événements reçus (temps réel) :</label>
            <div class="response-box" style="max-height:300px;min-height:100px" id="r-sub">En attente de connexion…</div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════ gRPC ═══ -->
    <div class="tab-content" id="content-grpc">
        <div class="section-title">
            <span class="dot" style="background:var(--grpc);width:14px;height:14px"></span>
            gRPC — Sensor Service
            <span style="font-size:.8rem;color:var(--muted);font-weight:400">Protocol Buffers · localhost:50051</span>
        </div>

        <div class="info-box grpc">
            gRPC utilise <strong>Protocol Buffers</strong> (Protobuf) comme format de sérialisation binaire
            et <strong>HTTP/2</strong> comme transport. Le fichier <code>sensor.proto</code> définit le contrat —
            les fichiers <code>sensor_pb2.py</code> et <code>sensor_pb2_grpc.py</code> sont
            <strong>auto-générés</strong> par <code>protoc</code>.
        </div>

        <div class="grid2">
            <!-- SERVEUR gRPC -->
            <div class="panel">
                <h3><span class="badge badge-grpc">SERVEUR</span> Lancer le serveur gRPC</h3>
                <p style="font-size:.82rem;color:var(--muted);margin-bottom:.8rem">
                    Le serveur gRPC écoute sur le port <strong>50051</strong>. Reçoit un <code>sensor_id</code>, retourne une température simulée de 22.5°C.
                </p>
                <div class="input-row">
                    <button class="btn btn-grpc" onclick="grpcStartServer()">Démarrer le serveur</button>
                </div>
                <div class="status-bar">
                    <span class="status-dot idle" id="s-grpc-server"></span>
                    <span id="st-grpc-server">Inactif</span>
                </div>
                <label style="display:block;margin-top:.8rem;margin-bottom:.4rem">Sortie du serveur :</label>
                <div class="response-box" style="max-height:280px;min-height:120px" id="r-grpc-server">En attente…</div>
            </div>

            <!-- CLIENT gRPC -->
            <div class="panel">
                <h3><span class="badge badge-grpc">CLIENT</span> Appeler le serveur gRPC</h3>
                <p style="font-size:.82rem;color:var(--muted);margin-bottom:.8rem">
                    Envoie une requête <code>SensorRequest</code> au serveur et récupère la température.
                </p>
                <div class="input-row">
                    <label>Capteur ID :</label>
                    <input type="text" id="grpc-sensor-id" value="SN-001" style="width:140px">
                    <button class="btn btn-grpc" onclick="grpcCallClient()">Lancer le client</button>
                </div>
                <div class="status-bar">
                    <span class="status-dot idle" id="s-grpc-client"></span>
                    <span id="st-grpc-client">Inactif</span>
                </div>
                <label style="display:block;margin-top:.8rem;margin-bottom:.4rem">Résultat du client :</label>
                <div class="response-box" style="max-height:220px;min-height:100px" id="r-grpc-client">En attente…</div>
            </div>
        </div>

        <!-- PROTO -->
        <div class="panel">
            <h3><span class="badge badge-grpc">PROTO</span> Contrat — sensor.proto</h3>
            <p style="font-size:.8rem;color:var(--muted);margin-bottom:.8rem">Source de vérité du service — définit les messages et le service RPC :</p>
            <div class="code-block">syntax = <span class="hl-val">"proto3"</span>;
package sensorservice;

                    service Sensor {
                    rpc <span class="hl-type">GetTemperature</span> (<span class="hl-type">SensorRequest</span>)
                    returns (<span class="hl-type">SensorResponse</span>);
                    }

                    message <span class="hl-type">SensorRequest</span> {
                    string sensor_id = 1;
                    }

message <span class="hl-type">SensorResponse</span> {
  float  temperature = 1;
  string unit        = 2;
}</div>
            <p style="font-size:.75rem;color:var(--muted);margin-top:.8rem">
                Compilé avec <code>protoc</code> → génère <code>sensor_pb2.py</code> + <code>sensor_pb2_grpc.py</code>
            </p>
        </div>

    </div>

    <script>
        const REST = 'http://localhost:5000';
        const GQL = 'http://localhost:5001/graphql';
        const BRIDGE = 'http://localhost:8083';

        function switchTab(name) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-' + name).classList.add('active');
            document.getElementById('content-' + name).classList.add('active');
        }

        /* ── helpers ── */
        function setStatus(id, ok, label) {
            const dot = document.getElementById('s-' + id);
            const st = document.getElementById('st-' + id);
            dot.className = 'status-dot ' + (ok === null ? 'idle' : ok ? 'ok' : 'err');
            st.textContent = label;
        }
        function setResponse(id, text, ok) {
            const box = document.getElementById('r-' + id);
            box.textContent = text;
            box.style.color = ok === false ? 'var(--error)' : ok === true ? 'var(--success)' : '#c9d1d9';
        }
        function fmt(obj) { return JSON.stringify(obj, null, 2); }

        async function call(method, url, body, statusId) {
            setStatus(statusId, null, 'Envoi…');
            try {
                const opts = { method, headers: { 'Content-Type': 'application/json' } };
                if (body) opts.body = JSON.stringify(body);
                const r = await fetch(url, opts);
                const ok = r.ok || r.status === 304;
                const text = r.status === 204 || r.status === 304
                    ? `HTTP ${r.status} — Pas de contenu / Ressource en cache`
                    : fmt(await r.json());
                setStatus(statusId, ok, `HTTP ${r.status} ${r.statusText}`);
                setResponse(statusId, text, ok);
            } catch (e) {
                setStatus(statusId, false, 'Erreur réseau');
                setResponse(statusId, `Impossible de joindre le serveur.\n→ Lancez d'abord : python REST/app.py\n\n${e}`, false);
            }
        }

        /* ── REST ── */
        async function restGetAll() {
            const country = document.getElementById('rest-country').value;
            const max_price = document.getElementById('rest-maxprice').value;
            let url = REST + '/destinations';
            const params = [];
            if (country) params.push('country=' + country);
            if (max_price) params.push('max_price=' + max_price);
            if (params.length) url += '?' + params.join('&');
            await call('GET', url, null, 'getall');
        }
        async function restGetOne() { await call('GET', `${REST}/destinations/${document.getElementById('rest-getid').value}`, null, 'getone'); }
        async function restPost() {
            const activities = document.getElementById('rest-pact').value.split(',').map(s => s.trim());
            await call('POST', `${REST}/destinations`, {
                name: document.getElementById('rest-pname').value,
                country: document.getElementById('rest-pct').value,
                price_per_day: +document.getElementById('rest-pprice').value,
                activities
            }, 'post');
        }
        async function restPut() {
            const id = document.getElementById('rest-putid').value;
            const activities = document.getElementById('rest-putactivities').value.split(',').map(s => s.trim()).filter(Boolean);
            await call('PUT', `${REST}/destinations/${id}`, {
                name: document.getElementById('rest-putname').value,
                country: document.getElementById('rest-putcountry').value,
                price_per_day: +document.getElementById('rest-putprice').value,
                activities
            }, 'put');
        }
        async function restPatch() {
            const id = document.getElementById('rest-patchid').value;
            await call('PATCH', `${REST}/destinations/${id}`, {
                price_per_day: +document.getElementById('rest-patchprice').value
            }, 'patch');
        }
        async function restDelete() {
            const id = document.getElementById('rest-delid').value;
            await call('DELETE', `${REST}/destinations/${id}`, null, 'del');
        }

        /* ── GraphQL ── */
        function gqlPreset(q) { document.getElementById('gql-query').value = q; }

        async function gqlSend() {
            const query = document.getElementById('gql-query').value.trim();
            setStatus('gql', null, 'Envoi…');
            try {
                const r = await fetch(GQL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                const json = await r.json();
                const ok = !json.errors;
                setStatus('gql', ok, ok ? 'Succès' : 'Erreur GraphQL');
                setResponse('gql', fmt(json), ok);
            } catch (e) {
                setStatus('gql', false, 'Erreur réseau');
                setResponse('gql', `Impossible de joindre le serveur GraphQL.\n→ Lancez d'abord : python graphQL/server.py\n\n${e}`, false);
            }
        }

        /* ── GraphQL Subscription (SSE) ── */
        let _sseSource = null;
        let _sseCount = 0;

        function gqlSubscribe() {
            if (_sseSource) return; // déjà connecté

            _sseSource = new EventSource('http://localhost:5001/graphql/subscribe');
            setStatus('sub', null, 'Connexion…');
            document.getElementById('r-sub').textContent = '';

            _sseSource.onopen = () => {
                setStatus('sub', true, 'Connecté — en écoute…');
                document.getElementById('btn-sub').disabled = true;
            };

            _sseSource.onmessage = (e) => {
                const event = JSON.parse(e.data);

                if (event.type === 'heartbeat') return; // ignorer les pings

                _sseCount++;
                document.getElementById('sub-counter').textContent = `${_sseCount} événement(s) reçu(s)`;

                const box = document.getElementById('r-sub');
                const now = new Date().toLocaleTimeString();

                // couleur selon le type d'événement
                const colors = {
                    connected:           '#8b949e',
                    destinationAdded:    '#22c55e',
                    destinationUpdated:  '#f59e0b',
                    destinationDeleted:  '#ef4444',
                };
                const color = colors[event.type] || '#c9d1d9';

                const icons = {
                    connected:           'CONNECTED',
                    destinationAdded:    'ADDED',
                    destinationUpdated:  'UPDATED',
                    destinationDeleted:  'DELETED',
                };
                const label = icons[event.type] || event.type;

                const line = document.createElement('div');
                line.style.cssText = `color:${color};border-bottom:1px solid #1e293b;padding:.3rem 0;margin-bottom:.2rem`;
                line.textContent = `[${now}] ${label}  ${event.data ? JSON.stringify(event.data) : event.message || ''}`;
                box.prepend(line); // plus récent en haut
            };

            _sseSource.onerror = () => {
                setStatus('sub', false, 'Connexion perdue');
                gqlUnsubscribe();
            };
        }

        function gqlUnsubscribe() {
            if (_sseSource) {
                _sseSource.close();
                _sseSource = null;
            }
            setStatus('sub', null, 'Déconnecté');
            document.getElementById('btn-sub').disabled = false;
            document.getElementById('sub-counter').textContent = '';
            _sseCount = 0;
        }

        // ── gRPC ──────────────────────────────────────────────────────────────
        async function grpcStartServer() {
            setStatus('grpc-server', null, 'Démarrage du serveur...');
            try {
                const response = await fetch('http://localhost:5000/run-grpc-server', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const json = await response.json();
                if (json.success) {
                    setStatus('grpc-server', true, 'Serveur en ligne');
                    setResponse('grpc-server', `Serveur gRPC lancé sur le port 50051\n\nSortie:\n${json.output}`, true);
                } else {
                    setStatus('grpc-server', false, 'Erreur');
                    setResponse('grpc-server', `Erreur au démarrage:\n${json.error}`, false);
                }
            } catch (e) {
                setStatus('grpc-server', false, 'Erreur réseau');
                setResponse('grpc-server', `Impossible de joindre le serveur REST.\n\nAssurez-vous que REST/app.py est lancé.\n\n${e}`, false);
            }
        }

        async function grpcCallClient() {
            const sensorId = document.getElementById('grpc-sensor-id').value.trim() || 'SN-001';
            setStatus('grpc-client', null, 'Lancement du client...');
            try {
                const response = await fetch('http://localhost:5000/run-grpc-client', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sensor_id: sensorId })
                });
                const json = await response.json();
                if (json.success) {
                    setStatus('grpc-client', true, 'Client exécuté');
                    setResponse('grpc-client', `Réponse du serveur gRPC:\n\n${json.output}`, true);
                } else {
                    setStatus('grpc-client', false, 'Erreur');
                    setResponse('grpc-client', `Erreur lors de l'exécution du client:\n${json.error}`, false);
                }
            } catch (e) {
                setStatus('grpc-client', false, 'Erreur réseau');
                setResponse('grpc-client', `Impossible de joindre le serveur REST.\n\nAssurez-vous que:\n  1. python REST/app.py\n  2. python grpc/server.py\n\n${e}`, false);
            }
        }
    </script>
</body>

</html>